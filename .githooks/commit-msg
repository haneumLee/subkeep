#!/bin/bash
# ====================================
# SubKeep Commit Message Hook
# ====================================
# Validates commit messages follow Conventional Commits format

set -e

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Skip merge commits
if echo "$COMMIT_MSG" | grep -qE '^Merge '; then
  exit 0
fi

# Conventional Commits regex
# Format: <type>(<scope>): <subject>
PATTERN='^(feat|fix|docs|style|refactor|perf|test|chore|build|ci|revert)(\(.+\))?: .{3,}'

if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
  echo -e "${RED}‚ùå Invalid commit message format!${NC}"
  echo ""
  echo "Your commit message:"
  echo "  $COMMIT_MSG"
  echo ""
  echo "Should follow Conventional Commits format:"
  echo "  <type>(<scope>): <subject>"
  echo ""
  echo "Types:"
  echo "  feat:     A new feature"
  echo "  fix:      A bug fix"
  echo "  docs:     Documentation only changes"
  echo "  style:    Code style changes (formatting, etc)"
  echo "  refactor: Code refactoring"
  echo "  perf:     Performance improvements"
  echo "  test:     Adding or updating tests"
  echo "  chore:    Maintenance tasks"
  echo "  build:    Build system changes"
  echo "  ci:       CI/CD changes"
  echo "  revert:   Revert a previous commit"
  echo ""
  echo "Examples:"
  echo "  ${GREEN}feat(api): add user authentication endpoint${NC}"
  echo "  ${GREEN}fix(ui): resolve button alignment issue${NC}"
  echo "  ${GREEN}docs: update installation guide${NC}"
  echo "  ${GREEN}refactor(db): optimize query performance${NC}"
  echo ""
  exit 1
fi

exit 0
